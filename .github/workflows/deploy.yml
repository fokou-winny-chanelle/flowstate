name: Deploy to Render

on:
  workflow_run:
    workflows: ["CI"]
    types:
      - completed
    branches:
      - master
  workflow_dispatch: # Permet de d√©clencher manuellement

jobs:
  deploy-backend:
    if: ${{ github.event.workflow_run.conclusion == 'success' || github.event_name == 'workflow_dispatch' }}
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Render Backend Deployment
        run: |
          if [ -z "$RENDER_BACKEND_DEPLOY_HOOK" ]; then
            echo " RENDER_BACKEND_DEPLOY_HOOK not set. Skipping backend deployment."
            exit 0
          fi
          echo " Triggering Render backend deployment..."
          curl -X POST "$RENDER_BACKEND_DEPLOY_HOOK"
        env:
          RENDER_BACKEND_DEPLOY_HOOK: ${{ secrets.RENDER_BACKEND_DEPLOY_HOOK }}
        continue-on-error: true

  deploy-frontend:
    if: ${{ github.event.workflow_run.conclusion == 'success' || github.event_name == 'workflow_dispatch' }}
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Render Frontend Deployment
        run: |
          if [ -z "$RENDER_FRONTEND_DEPLOY_HOOK" ]; then
            echo " RENDER_FRONTEND_DEPLOY_HOOK not set. Skipping frontend deployment."
            exit 0
          fi
          echo " Triggering Render frontend deployment..."
          curl -X POST "$RENDER_FRONTEND_DEPLOY_HOOK"
        env:
          RENDER_FRONTEND_DEPLOY_HOOK: ${{ secrets.RENDER_FRONTEND_DEPLOY_HOOK }}
        continue-on-error: true
